<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>M.ASAD Billing System</title>
<link rel="manifest" href="manifest.json" />
<style>
  body {
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    margin: 0;
    background: linear-gradient(135deg, #007bff, #00c6ff);
    min-height: 100vh;
    color: #222;
  }
  .header {
    background: rgba(0, 0, 0, 0.7);
    color: #fff;
    padding: 20px 10px;
    text-align: center;
    font-weight: 700;
    font-size: 1.5rem;
  }
  .container {
    max-width: 450px;
    margin: 15px auto;
    background: #fff;
    border-radius: 12px;
    padding: 15px 20px 30px;
    box-shadow: 0 4px 12px rgb(0 0 0 / 0.25);
  }
  h2 {
    margin-top: 0;
    text-align: center;
    color: #007bff;
  }
  input, select, button {
    width: 100%;
    padding: 10px;
    margin: 8px 0 12px;
    border-radius: 6px;
    border: 1px solid #ccc;
    font-size: 1rem;
  }
  button {
    background-color: #007bff;
    border: none;
    color: white;
    font-weight: 600;
    cursor: pointer;
    transition: background-color 0.3s ease;
  }
  button:hover {
    background-color: #0056b3;
  }
  button.danger {
    background-color: #dc3545;
  }
  button.danger:hover {
    background-color: #a71d2a;
  }
  #bill-list div {
    border-bottom: 1px solid #ddd;
    padding: 5px 0;
  }
  #total-amount {
    font-weight: 700;
    font-size: 1.2rem;
    text-align: right;
    margin-top: 15px;
    color: #28a745;
  }
  .section {
    margin-bottom: 25px;
  }
</style>
</head>
<body>

<div class="header">M.ASAD Billing System</div>

<div class="container">

  <!-- Product Management Section -->
  <div class="section" id="product-management">
    <h2>Manage Products</h2>
    <input type="text" id="product-name" placeholder="Product Name" />
    <input type="number" id="product-price" placeholder="Price" min="0" />
    <button id="add-product-btn">Add / Update Product</button>

    <select id="product-select" size="4" style="width:100%; margin-top:10px;"></select>
    <button id="remove-product-btn" class="danger">Remove Selected Product</button>
  </div>

  <!-- Billing Section -->
  <div class="section" id="billing-section">
    <h2>Create Bill</h2>
    <select id="bill-product-select">
      <option value="" disabled selected>Select Product</option>
    </select>
    <input type="number" id="bill-qty" placeholder="Quantity" min="1" />
    <input type="number" id="bill-discount" placeholder="Discount (%)" min="0" max="100" />
    <button id="add-to-bill-btn">Add To Bill</button>

    <div id="bill-list" style="margin-top: 15px;"></div>
    <div id="total-amount">Total: Rs 0.00</div>
    <button id="clear-bill-btn" class="danger" style="margin-top: 15px;">Clear Bill</button>
  </div>

</div>

<script>
  // Data storage keys
  const PRODUCTS_KEY = 'billing_products';
  const CART_KEY = 'billing_cart';

  // Cached DOM elements
  const productNameInput = document.getElementById('product-name');
  const productPriceInput = document.getElementById('product-price');
  const addProductBtn = document.getElementById('add-product-btn');
  const productSelect = document.getElementById('product-select');
  const removeProductBtn = document.getElementById('remove-product-btn');

  const billProductSelect = document.getElementById('bill-product-select');
  const billQtyInput = document.getElementById('bill-qty');
  const billDiscountInput = document.getElementById('bill-discount');
  const addToBillBtn = document.getElementById('add-to-bill-btn');
  const billListDiv = document.getElementById('bill-list');
  const totalAmountDiv = document.getElementById('total-amount');
  const clearBillBtn = document.getElementById('clear-bill-btn');

  // Data variables
  let products = JSON.parse(localStorage.getItem(PRODUCTS_KEY)) || [];
  let cart = [];

  // Initialize the app
  function init() {
    renderProductList();
    renderBillProductList();
    renderCart();
  }

  // Render product select list for management
  function renderProductList() {
    productSelect.innerHTML = '';
    if (products.length === 0) {
      productSelect.innerHTML = '<option disabled>No products added</option>';
      return;
    }
    products.forEach((prod, i) => {
      let option = document.createElement('option');
      option.value = i;
      option.textContent = `${prod.name} - Rs ${prod.price.toFixed(2)}`;
      productSelect.appendChild(option);
    });
  }

  // Render product select for billing
  function renderBillProductList() {
    billProductSelect.innerHTML = '<option value="" disabled selected>Select Product</option>';
    products.forEach((prod, i) => {
      let option = document.createElement('option');
      option.value = i;
      option.textContent = `${prod.name} - Rs ${prod.price.toFixed(2)}`;
      billProductSelect.appendChild(option);
    });
  }

  // Save products to localStorage
  function saveProducts() {
    localStorage.setItem(PRODUCTS_KEY, JSON.stringify(products));
  }

  // Add or update product
  addProductBtn.addEventListener('click', () => {
    const name = productNameInput.value.trim();
    const price = parseFloat(productPriceInput.value);
    if (!name || isNaN(price) || price < 0) {
      alert('Please enter valid product name and price.');
      return;
    }
    // Check if product exists to update price
    const existingIndex = products.findIndex(p => p.name.toLowerCase() === name.toLowerCase());
    if (existingIndex > -1) {
      products[existingIndex].price = price;
      alert('Product updated successfully.');
    } else {
      products.push({ name, price });
      alert('Product added successfully.');
    }
    productNameInput.value = '';
    productPriceInput.value = '';
    saveProducts();
    renderProductList();
    renderBillProductList();
  });

  // Remove selected product from management list
  removeProductBtn.addEventListener('click', () => {
    const selectedIndex = productSelect.selectedIndex;
    if (selectedIndex < 0) {
      alert('Please select a product to remove.');
      return;
    }
    if (!confirm('Are you sure you want to remove this product?')) return;
    products.splice(selectedIndex, 1);
    saveProducts();
    renderProductList();
    renderBillProductList();
  });

  // Add to bill
  addToBillBtn.addEventListener('click', () => {
    const productIndex = billProductSelect.value;
    const qty = parseInt(billQtyInput.value);
    const discount = parseFloat(billDiscountInput.value) || 0;

    if (productIndex === '' || productIndex === null) {
      alert('Please select a product.');
      return;
    }
    if (isNaN(qty) || qty <= 0) {
      alert('Please enter a valid quantity.');
      return;
    }
    if (discount < 0 || discount > 100) {
      alert('Discount must be between 0 and 100.');
      return;
    }
    const product = products[productIndex];
    const priceTotal = product.price * qty;
    const discountAmount = priceTotal * (discount / 100);
    const finalPrice = priceTotal - discountAmount;

    cart.push({
      productName: product.name,
      quantity: qty,
      pricePerUnit: product.price,
      discountPercent: discount,
      totalPrice: finalPrice,
    });

    renderCart();

    // Reset billing inputs
    billProductSelect.value = '';
    billQtyInput.value = '';
    billDiscountInput.value = '';
  });

  // Render bill list & total
  function renderCart() {
    billListDiv.innerHTML = '';
    let total = 0;
    if (cart.length === 0) {
      billListDiv.innerHTML = '<p><i>No items in the bill.</i></p>';
      totalAmountDiv.textContent = 'Total: Rs 0.00';
      return;
    }
    cart.forEach((item, i) => {
      const itemDiv = document.createElement('div');
      itemDiv.textContent = `${item.productName} x ${item.quantity} @ Rs ${item.pricePerUnit.toFixed(2)} each, Discount: ${item.discountPercent}% â†’ Rs ${item.totalPrice.toFixed(2)}`;
      billListDiv.appendChild(itemDiv);
      total += item.totalPrice;
    });
    totalAmountDiv.textContent = `Total: Rs ${total.toFixed(2)}`;
  }

  // Clear bill button
  clearBillBtn.addEventListener('click', () => {
    if (cart.length === 0) {
      alert('Bill is already empty.');
      return;
    }
    if (!confirm('Are you sure you want to clear the bill?')) return;
    cart = [];
    renderCart();
  });

  // Initialize app on page load
  window.onload = init;
</script>

<script>
  if ("serviceWorker" in navigator) {
    navigator.serviceWorker.register("service-worker.js")
      .then(() => console.log("Service Worker registered"))
      .catch(err => console.error("Service Worker registration failed:", err));
  }
</script>

</body>
</html>
